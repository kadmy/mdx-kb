# План следующих шагов для MDX Sandbox

## Текущее состояние (v2.0) ✅

### Реализовано
- ✅ Runtime MDX compilation с live preview
- ✅ Единый dev-сервер (Vite middleware вместо Express)
- ✅ Валидация YAML и MDX с показом ошибок
- ✅ Индикация несохраненных изменений
- ✅ Настоящие Tooltip компоненты для терминов
- ✅ ErrorBoundary для перехвата ошибок рендеринга
- ✅ Debounce для оптимизации компиляции
- ✅ Компоненты работают с PascalCase синтаксисом

### Архитектурные решения
```
App.jsx (main)
  ├── Runtime MDX compiler (mdx-compiler.js)
  │   └── evaluate() с useMDXComponents
  ├── Validation (validator.js)
  ├── Debounce (debounce.js)
  └── Components
      ├── Term (с Tooltip)
      ├── Concept
      ├── Glossary
      ├── ErrorBoundary
      └── ValidationPanel
```

## Этап 1: UX улучшения (приоритет: ВЫСОКИЙ)

### 1.1 Form-based редактор frontmatter
**Проблема:** Редактирование YAML в textarea сложное и опасное
**Решение:**
- Создать компонент `FrontmatterForm.jsx`
- Поля: title (required), tags (chips), concepts (multi-select), terms (multi-select)
- Автокомплит для существующих тегов/концепций
- Валидация на уровне формы

**Файлы:**
- `src/components/FrontmatterForm.jsx` (новый)
- `src/App.jsx` (обновить)

### 1.2 Monaco Editor для MDX
**Проблема:** Textarea без подсветки синтаксиса
**Решение:**
- Интеграция `@monaco-editor/react`
- MDX syntax highlighting
- Line numbers, minimap
- Error markers из валидации

**Зависимости:**
```bash
npm install @monaco-editor/react monaco-editor
```

### 1.3 Split panel с изменяемым размером
**Проблема:** Фиксированные 50/50 не всегда удобны
**Решение:**
- Библиотека `react-split` или custom решение
- Сохранение размеров в localStorage

## Этап 2: Структура данных (приоритет: ВЫСОКИЙ)

### 2.1 Единый источник данных для терминов
**Текущее состояние:** Определения хардкоженны в `term.jsx`

**Решение:**
```javascript
// src/data/terms.js
export const TERMS = {
  'логос': {
    name: 'логос',
    definition: 'Божественный замысел в действии, Слово.',
    etymology: 'Греч: λόγος',
    relatedConcepts: ['zamysel-vsevyshnego'],
    examples: ['...'],
  },
  // ...
}
```

**Файлы:**
- `src/data/terms.js` (новый)
- `src/data/concepts.js` (новый)
- `src/components/term.jsx` (обновить - импорт из data)
- `src/components/concept.jsx` (обновить)

### 2.2 Фасетная структура
**Для масштабирования на 5000 документов:**

```javascript
// src/data/facets.js
export const FACETS = {
  speakers: ['Михаэль Лайтман', 'Община'],
  series: ['Зоар', 'Талмуд Десяти Сфирот'],
  difficulty: ['начальный', 'средний', 'продвинутый'],
  format: ['урок', 'беседа', 'вопрос-ответ'],
  dateRange: {
    start: '2020-01-01',
    end: '2025-12-31'
  }
}
```

## Этап 3: Система концепций (приоритет: СРЕДНИЙ)

### 3.1 Убрать заглушки
**Текущее:** `handleShowConcept` показывает "Содержимое для концепции: ${id}"

**Решение:**
```javascript
// src/data/concepts.js
export const CONCEPTS = {
  'zamysel-vsevyshnego': {
    id: 'zamysel-vsevyshnego',
    title: 'Замысел Всевышнего',
    description: 'Планы Всевышнего...',
    relatedTerms: ['логос', 'берешит'],
    articles: ['content.mdx', 'lesson-001.mdx'], // backreferences
    content: `
      # Замысел Всевышнего

      Подробное описание концепции...
    `
  }
}
```

### 3.2 Навигация между концепциями
- Модальное окно с полным контентом концепции
- Ссылки на связанные концепции
- История просмотра концепций

## Этап 4: Мультифайловая поддержка (приоритет: СРЕДНИЙ)

### 4.1 Файловый браузер
**Текущее:** Редактируется только один файл `content.mdx`

**Решение:**
- Левая панель с деревом файлов
- Возможность создавать новые `.mdx` файлы
- Переключение между файлами
- Поиск по файлам

**Структура:**
```
knowledge-base/
├── concepts/
│   ├── zamysel.mdx
│   └── edinstvo.mdx
├── lessons/
│   ├── 2025-01-15-урок.mdx
│   └── 2025-01-16-урок.mdx
└── terms/
    └── glossary.mdx
```

### 4.2 API для работы с файлами
**Обновить Vite middleware:**
- `GET /api/files` - список файлов
- `GET /api/file/:path` - загрузка файла
- `POST /api/file/:path` - сохранение
- `DELETE /api/file/:path` - удаление
- `POST /api/file/create` - создание нового

## Этап 5: Поиск и фильтрация (приоритет: НИЗКИЙ)

### 5.1 Полнотекстовый поиск
- По контенту MDX
- По терминам и концепциям
- По frontmatter (теги, автор, дата)

### 5.2 Фасетная фильтрация
- По спикерам
- По сериям уроков
- По датам
- По сложности

## Этап 6: Экспорт и интеграция (приоритет: НИЗКИЙ)

### 6.1 Экспорт
- Export to HTML
- Export to PDF
- Export to Markdown (без JSX компонентов)

### 6.2 Интеграция в solid-version
- Адаптация под SolidJS Start
- SSR для MDX контента
- SEO оптимизация
- Routing для каждого документа

## Технический долг

### Улучшения кода
- [ ] Убрать console.log из production build
- [ ] Добавить TypeScript
- [ ] Unit тесты для валидаторов
- [ ] E2E тесты для редактора
- [ ] Оптимизация bundle size

### Документация
- [ ] JSDoc для всех функций
- [ ] Storybook для компонентов
- [ ] Видео-туториал по использованию

## Приоритизация

### Что делать в первую очередь (Этап 1-2):
1. ✅ **Form-based frontmatter editor** - критично для UX
2. ✅ **Единый источник данных** - критично для масштабирования
3. ✅ **Monaco Editor** - сильно улучшит DX
4. ⚠️ **Система концепций** - убрать заглушки

### Что можно отложить (Этап 4-6):
- Мультифайловая поддержка (пока работаем с одним файлом)
- Поиск и фильтрация (нужно когда будет много документов)
- Экспорт (nice to have)

## Метрики успеха

### Производительность
- [ ] Компиляция < 500ms для документа 10kb
- [ ] Первая отрисовка < 1s
- [ ] Сохранение < 200ms

### UX
- [ ] Новый пользователь может создать документ за < 5 минут
- [ ] 0 ошибок при типичном использовании
- [ ] Интуитивно понятный интерфейс без документации

## Вопросы для обсуждения

1. **Хранение данных:** Файловая система или база данных?
2. **Версионирование:** Git или встроенная система версий?
3. **Коллаборация:** Нужна ли одновременная работа нескольких пользователей?
4. **Деплой:** Self-hosted или cloud?
5. **Безопасность:** Аутентификация и авторизация?

## Заметки

- Текущая архитектура готова к масштабированию
- Runtime compilation работает стабильно с PascalCase компонентами
- Vite HMR отлично работает для разработки
- SolidJS + MDX показали хорошую производительность